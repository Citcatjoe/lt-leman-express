function sw(){year="2017"==year?"2007":"2017",update()}function getContinentByName(t){return continentFound=!1,$.each(data.children,(function(e,n){n.name!==t||(continentFound=n)})),continentFound}function colors(t){return color_dict={"Amérique du Nord":"#3172B8",Europe:"#E69200",Asie:"#758B8F",Afrique:"#9D9200","Amérique du Sud":"#C00D0D","Océanie":"#cdab02"},color_dict[t]}function update(t){function e(t){var e=!1,n="";if(t.children){var r=getContinentByName(t.data.name);testnode=r;var a=d3.hierarchy(r).sum((function(t){return t.size_2007})).value,i;e=(d3.hierarchy(r).sum((function(t){return t.size_2017})).value-a)/a}else e=(t.data.size_2017-t.data.size_2007)/t.data.size_2007;return e&&(n=formatNumber(100*e)+"% entre 2007 et 2017"),e>=0&&(n="+"+n),n}function n(t){var n=t.value;n>1e3?(unit="milliards de CHF",n/=1e3):unit="millions de CHF",label1.text(t.data.name),label2.text(formatNumber(n)),label3.text(unit),label4.text(e(t))}function r(t){h.datum(t.parent||d),d.each((function(e){return e.target={x0:2*Math.max(0,Math.min(1,(e.x0-t.x0)/(t.x1-t.x0)))*Math.PI,x1:2*Math.max(0,Math.min(1,(e.x1-t.x0)/(t.x1-t.x0)))*Math.PI,y0:Math.max(0,e.y0-t.depth),y1:Math.max(0,e.y1-t.depth)}}));var e=g.transition().duration(750);s.transition(e).tween("data",(function(t){var e=d3.interpolate(t.current,t.target);return function(n){return t.current=e(n)}})).filter((function(t){return+this.getAttribute("fill-opacity")||a(t.target)})).attr("fill-opacity",(function(t){return a(t.target)?t.children?.6:.4:0})).attrTween("d",(function(t){return function(){return arc(t.current)}})),f.filter((function(t){return+this.getAttribute("fill-opacity")||i(t.target)})).transition(e).attr("fill-opacity",(function(t){return+i(t.target)})).attrTween("transform",(function(t){return function(){return u(t.current)}}))}function a(t){return t.y1<=3&&t.y0>=1&&t.x1>t.x0}function i(t){return t.y1<=3&&t.y0>=1&&(t.y1-t.y0)*(t.x1-t.x0)>.03}function u(t){var e=(t.x0+t.x1)/2*180/Math.PI,n=(t.y0+t.y1)/2*radius;return"rotate(".concat(e-90,") translate(").concat(n,",0) rotate(").concat(e<180?0:180,")")}var c=arguments.length>0&&void 0!==t?t:data;data=c,color||(color=d3.scaleOrdinal().range(d3.quantize(d3.interpolateRainbow,data.children.length+1)));var o=d3.transition().duration(250),l=g.selectAll("*").data(data,(function(t){return t}));label1.text(""),label2.text(""),label3.text(""),label4.text(""),l.exit().attr("class","exit").transition(o).attr("y",60).style("fill-opacity",1e-6).remove(),l.attr("class","update").attr("y",0).style("fill-opacity",1).transition(o).attr("x",(function(t,e){return 32*e}));var d=partition(data);d.each((function(t){return t.current=t}));var s=l.enter().append("path").data(d.descendants().slice(1)).join("path").attr("fill",(function(t){for(;t.depth>1;)t=t.parent;return colors(t.data.name)})).attr("fill-opacity",(function(t){return a(t.current)?opaque?t.children?.6:.4:"Amérique du Nord"==t.data.name?.9:"Amérique du Nord"===t.parent.data.name?.8:t.children?.15:.1:0})).attr("d",(function(t){return arc(t.current)})).on("mouseover",n);s.filter((function(t){return t.children})).style("cursor","pointer").on("click",r),s.filter((function(t){return!t.children})).style("cursor","pointer").on("click",n);var f=g.append("g").attr("pointer-events","none").attr("text-anchor","middle").style("user-select","none").selectAll("text").data(d.descendants().slice(1)).join("text").attr("dy","0.35em").attr("fill-opacity",(function(t){return+i(t.current)})).attr("transform",(function(t){return u(t.current)})).text((function(t){return t.data.name})),h=g.append("circle").datum(d).attr("r",radius).attr("class","central-circle").attr("fill","none").attr("pointer-events","all").on("click",r)}var formatNumber=d3.format(".1f"),width=932,radius=width/6,year="2017",data,opaque=!1,testnode;d3.select("#year-2007").on("click",(function(){year="2007",update()})),d3.select("#year-2017").on("click",(function(){year="2017",update()}));var arc=d3.arc().startAngle((function(t){return t.x0})).endAngle((function(t){return t.x1})).padAngle((function(t){return Math.min((t.x1-t.x0)/2,.005)})).padRadius(1.5*radius).innerRadius((function(t){return t.y0*radius})).outerRadius((function(t){return Math.max(t.y0*radius,t.y1*radius-1)})),partition=function t(e){var n=d3.hierarchy(e).sum((function(t){return t["size_"+year]}));return d3.partition().size([2*Math.PI,n.height+1])(n)},svg=d3.select("#sunburst").style("width","98%").style("height","auto").style("font","10px sans-serif"),label1=svg.append("text").attr("text-anchor","middle").attr("class","label1").attr("x",width/2).attr("y",width/2-30).text(""),label2=svg.append("text").attr("text-anchor","middle").attr("class","label2").attr("x",width/2).attr("y",width/2).text(""),label3=svg.append("text").attr("text-anchor","middle").attr("class","label3").attr("x",width/2).attr("y",width/2+30).text(""),label4=svg.append("text").attr("text-anchor","middle").attr("class","label4").attr("x",width/2).attr("y",width/2+50).text(""),g=svg.append("g").attr("transform","translate(".concat(width/2,",").concat(width/2,")")),color;d3.json("data/data-2012-2017.json").then(update);