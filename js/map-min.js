function showCaption(e,t){var o=resultById.get(e.id);if(o&&o.pop){var a='<span class="value">'+o.pop+"</span> habitants<br>";a+='<span class="value">'+o.density+"</span> habitants au km<sup>2</sup><br>",a+='<span class="value">'+o.youth+"%</span> de 0-24 ans dans la population"}else a="En attente du dépouillement (dernière mise à jour: lundi 0h54).";d3.select("#motherTip").html('<h3 class="statename">'+e.id+" – "+resultById.get(e.id).title+"</h3>"+a+"</span>")}function ready(e,t,o){if(e)throw console.log("Error:"+e),e;var t=topojson.feature(t,t.objects.departements);svg.selectAll(".departements").data(t.features).enter().append("path").attr("d",path).attr("fill",function(e){e.id=e.properties.code_insee;try{"2A"!=e.id&&"2B"!=e.id&&(e.id=parseInt(e.id))}catch(t){console.log("Could not parse as int "+e.properties.code_insee)}var t=resultById.get(e.id);if(t)return showYouth?colorScaleYouth(t.youth):colorScaleDensity(t.density);console.log("No matching row for "+e.properties.nom+" | "+e.properties.code_insee)}).attr("class","departements").on("mouseover",showCaption)}function changeData(e){function t(){switchLegend(),svg.selectAll(".departements").transition().duration(500).style("fill",function(e){var t=resultById.get(e.id);if(t)return showYouth?colorScaleYouth(t.youth):colorScaleDensity(t.density);console.log("No matching row for "+e.properties.nom+" | "+e.properties.code_insee)})}showYouth="youth"==e,t()}function switchLegend(){hideClassName=".legendYouth",showClassName=".legendDensity",showYouth&&(hideClassName=".legendDensity",showClassName=".legendYouth"),mapLegend.select(hideClassName).transition().duration(500).style("opacity",0),mapLegend.select(showClassName).transition().duration(500).style("opacity",1)}var width=570,height=520,baseScale=3e3,translateX=280,translateY=268,windowWidth=$(window).width();windowWidth<600&&(width=windowWidth-20,ratio=width/600,console.log("Width is "+windowWidth+" -> resize to ratio "+ratio),height*=ratio,baseScale*=ratio,translateX*=ratio,translateY*=ratio);var resultById=d3.map(),selectedRound="t2",showYouth=!1,colors={Macron:"orange","Le Pen":"#110c4e",Fillon:"#536797","Mélenchon":"#e80007",Hamon:"#c93d7c"},list_keys=["Nom","Prenom","Score","Nom_1","Prenom_1","Score_1","Nom_2","Prenom_2","Score_2","Nom_3","Prenom_3","Score_3","Nom_4","Prenom_4","Score_4","Nom_5","Prenom_5","Score_5"],projection=d3.geoConicConformal().center([2.454071,46.279229]).scale(baseScale).translate([translateX,translateY]),path=d3.geoPath().projection(projection),svg=d3.select("#map").append("svg").attr("width",width).attr("height",height),colorScaleDensity=d3.scaleThreshold().domain([50,100,200,500]).range(["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"]),colorScalePop=d3.scaleLinear().domain([76309,2605238]).range(["#fff","#110c4e"]),colorScaleYouth=d3.scaleThreshold().domain([22.5,25,25.5,30]).range(["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"]),abstentionScale=d3.scaleLinear().domain([15,35]).range(["#e2e2e2","black"]);d3.queue().defer(d3.json,"data/departements.json").defer(d3.csv,"data/population-2015-departements.csv",function(e){resultById.set(e.id,e)}).await(ready);var mapLegend=d3.select("#mapLegend");mapLegend.append("g").attr("class","legendDensity"),mapLegend.append("g").attr("class","legendYouth").style("opacity","0");var legendYouth=d3.legendColor().labelFormat(function(e){return d3.format(".1f")(e)}).labels(function(e){return d3.legendHelpers.thresholdLabels(e).replace("to","à").replace("Less than","Moins de").replace("More than","Plus de")+"%"}).scale(colorScaleYouth),legendDensity=d3.legendColor().labelFormat(d3.format(".0f")).labels(function(e){return d3.legendHelpers.thresholdLabels(e).replace("to","à").replace("Less than","Moins de").replace("More than","Plus de")}).scale(colorScaleDensity);mapLegend.select(".legendDensity").call(legendDensity),mapLegend.select(".legendYouth").call(legendYouth);